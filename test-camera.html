<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Camera Display</title>
</head>
<body>
    <h1>Camera Feed</h1>
    <video id="videoFeed" autoplay playsinline></video>

    <script>
        // Keywords for identifying back-facing cameras
        const backCameraKeywords = [
            "rear",
            "back",
            "rück",
            "arrière",
            "trasera",
            "trás",
            "traseira",
            "posteriore",
            "后面",
            "後面",
            "背面",
            "后置", // alternative
            "後置", // alternative
            "背置", // alternative
            "задней",
            "الخلفية",
            "후",
            "arka",
            "achterzijde",
            "หลัง",
            "baksidan",
            "bagside",
            "sau",
            "bak",
            "tylny",
            "takakamera",
            "belakang",
            "אחורית",
            "πίσω",
            "spate",
            "hátsó",
            "zadní",
            "darrere",
            "zadná",
            "задня",
            "stražnja",
            "belakang",
            "बैक"
        ];

        function isBackCameraLabel(label) {
            const lowercaseLabel = label.toLowerCase();
            return backCameraKeywords.some(keyword => lowercaseLabel.includes(keyword));
        }

        async function getCameraDevices() {
            const frontCameras = [];
            const backCameras = [];

            // Request media stream to trigger permission dialog
            const stream = await navigator.mediaDevices.getUserMedia({ audio: false, video: { facingMode: "environment" } });
            
            // Stop the stream right away after obtaining permissions
            stream.getTracks().forEach(track => track.stop());

            let devices = await navigator.mediaDevices.enumerateDevices();
            const cameras = devices.filter(device => device.kind === "videoinput");

            cameras.forEach(camera => {
                document.getElementById("logs").innerHTML += "forEach:" + camera.label + '<br>';
                if (isBackCameraLabel(camera.label)) {
                    backCameras.push(camera);
                } else {
                    frontCameras.push(camera);
                }
            });

            return {
                frontCameras,
                backCameras
            };
        }

        async function initCamera() {
            const videoFeed = document.getElementById('videoFeed');
            const { frontCameras, backCameras } = await getCameraDevices();
            let selectedCamera = null;

            if (backCameras.length > 0) {
                selectedCamera = backCameras[0];
            } else if (frontCameras.length > 0) {
                selectedCamera = frontCameras[0];
            }

            if (selectedCamera) {
                document.getElementById("logs").innerHTML += "backCameras:" + JSON.stringify(backCameras) + '<br>';

                document.getElementById("logs").innerHTML += "frontCameras:" + JSON.stringify(frontCameras) + '<br>';

                const constraints = {
                    video: {
                        deviceId: selectedCamera.deviceId,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                videoFeed.srcObject = stream;

                if (!isBackCameraLabel(selectedCamera.label)) {
                    videoFeed.style.transform = "scaleX(-1)";
                }
            }
        }

        // Initialize the camera on page load
        window.addEventListener('load', () => {
            initCamera();
        });
    </script>
</body>
</html>
