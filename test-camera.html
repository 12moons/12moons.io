<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Camera Display</title>
</head>
<body>
    <h1>Camera Feed</h1>
    <video id="videoFeed" autoplay playsinline></video>

    <script>
        // Keywords for identifying back-facing cameras
        const backCameraKeywords = ["rear", "back", "arrière", "задня", "stražnja", "belakang", "बैक"];

        function isBackCameraLabel(label) {
            const lowercaseLabel = label.toLowerCase();
            return backCameraKeywords.some(keyword => lowercaseLabel.includes(keyword));
        }

        async function getCameraDevices() {
            const frontCameras = [];
            const backCameras = [];

            let devices = await navigator.mediaDevices.enumerateDevices();
            const cameras = devices.filter(device => device.kind === "videoinput");

            console.log('devices', devices)
            console.log('cameras', cameras)

            cameras.forEach(camera => {
                console.log('forEach:', camera.label)
                if (isBackCameraLabel(camera.label)) {
                    backCameras.push(camera);
                } else {
                    frontCameras.push(camera);
                }
            });

            console.log('frontCameras=', frontCameras)
            console.log('backCameras=', backCameras)

            return {
                frontCameras,
                backCameras
            };
        }

        async function initCamera() {
            const videoFeed = document.getElementById('videoFeed');
            const { frontCameras, backCameras } = await getCameraDevices();
            let selectedCamera = null;

            if (backCameras.length > 0) {
                selectedCamera = backCameras[0];
            } else if (frontCameras.length > 0) {
                selectedCamera = frontCameras[0];
            }

            if (selectedCamera) {
                const constraints = {
                    video: {
                        deviceId: selectedCamera.deviceId,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                videoFeed.srcObject = stream;

                if (!isBackCameraLabel(selectedCamera.label)) {
                    videoFeed.style.transform = "scaleX(-1)";
                }
            }
        }

        // Initialize the camera on page load
        window.addEventListener('load', () => {
            initCamera();
        });
    </script>
</body>
</html>
